<div class="video-container">
  <!-- Video Element -->
  <video
    #videoElement
    class="hls-video"
    playsinline
    controls
    autoplay>
  </video>

  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="spinner-container">
        <div class="spinner"></div>
        <p>Cargando stream...</p>
      </div>
    </div>
  }

  <!-- Error Message -->
  @if (error()) {
    <div class="error-overlay">
      <div class="error-content">
        <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <h3>Error de Reproducci√≥n</h3>
        <p>{{ error() }}</p>
        @if (channel) {
          <button (click)="loadChannel(channel)" class="retry-btn">
            Reintentar
          </button>
        }
      </div>
    </div>
  }

  <!-- Audio Track Selector -->
  @if (channel && !error()) {
    <div class="audio-track-panel" [class.open]="showAudioMenu()" [class.has-tracks]="hasMultipleAudioTracks()">
      <!-- Toggle Button -->
      <button class="audio-toggle-btn" [class.single-track]="!hasMultipleAudioTracks()" (click)="toggleAudioMenu()" title="Pistas de audio">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
          <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
        </svg>
        @if (hasMultipleAudioTracks()) {
          <span class="audio-badge">{{ audioTracks().length }}</span>
        }
      </button>

      <!-- Audio Menu -->
      @if (showAudioMenu()) {
        <div class="audio-menu" (mouseleave)="closeAudioMenu()">
          <div class="audio-menu-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
            </svg>
            <span>Pistas de Audio</span>
          </div>
          <div class="audio-menu-list">
            @if (audioTracks().length > 1) {
              @for (track of audioTracks(); track track.id) {
                <button 
                  class="audio-track-item" 
                  [class.active]="track.enabled"
                  (click)="selectAudioTrack(track.id)">
                  <span class="track-indicator">
                    @if (track.enabled) {
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                      </svg>
                    } @else {
                      <span class="track-dot"></span>
                    }
                  </span>
                  <span class="track-label">{{ track.label }}</span>
                  @if (track.language) {
                    <span class="track-lang">{{ track.language.toUpperCase() }}</span>
                  }
                </button>
              }
            } @else {
              <div class="audio-no-tracks">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="16" x2="12" y2="12"/>
                  <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                <span>Este canal solo tiene una pista de audio</span>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- No Channel State -->
  @if (!channel && !error()) {
    <div class="empty-state">
      <div class="empty-content">
        <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        <h3>Vantix TV</h3>
        <p>Selecciona un canal para comenzar</p>
      </div>
    </div>
  }
</div>
