<div class="dashboard">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="!isSidebarOpen()" [class.mobile-open]="isMobileSidebarOpen()">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <div class="brand-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"/>
          </svg>
        </div>
        @if (isSidebarOpen()) {
          <span class="brand-name">Vantix<span class="brand-accent">IPTV</span></span>
        }
      </div>
      <button class="sidebar-toggle desktop-only" (click)="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          @if (isSidebarOpen()) {
            <path d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
          } @else {
            <path d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
          }
        </svg>
      </button>
      <button class="sidebar-close mobile-only" (click)="isMobileSidebarOpen.set(false)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Categories -->
    <div class="sidebar-content">
      <div class="sidebar-section">
        @if (isSidebarOpen()) {
          <p class="section-label">Categorías</p>
        }
        <nav class="category-nav">
          <button 
            (click)="selectCategory(null)"
            [class.active]="selectedCategoryId() === null && !showFavoritesOnly()"
            class="cat-btn"
            [title]="'Todos los canales'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
            </svg>
            @if (isSidebarOpen()) {
              <span>Todos</span>
              <span class="cat-count">{{ channels().length }}</span>
            }
          </button>
          <button 
            (click)="showFavoritesOnly.set(!showFavoritesOnly()); selectedCategoryId.set(null)"
            [class.active]="showFavoritesOnly()"
            class="cat-btn cat-fav"
            [title]="'Favoritos'">
            <svg viewBox="0 0 24 24" [class.fill-current]="showFavoritesOnly()" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
            @if (isSidebarOpen()) {
              <span>Favoritos</span>
            }
          </button>

          <div class="cat-divider"></div>

          @for (category of categories(); track category.id) {
            <button 
              (click)="selectCategory(category.id); showFavoritesOnly.set(false)"
              [class.active]="selectedCategoryId() === category.id"
              class="cat-btn"
              [title]="category.name">
              <span class="cat-initial">{{ category.name.charAt(0) }}</span>
              @if (isSidebarOpen()) {
                <span class="cat-name">{{ category.name }}</span>
                <span class="cat-count">{{ getCategoryCount(category.id) }}</span>
              }
            </button>
          }
        </nav>
      </div>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <button (click)="logout()" class="logout-btn" title="Cerrar Sesión">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
        @if (isSidebarOpen()) {
          <span>Cerrar Sesión</span>
        }
      </button>
    </div>
  </aside>

  <!-- Sidebar overlay (mobile) -->
  @if (isMobileSidebarOpen()) {
    <div class="sidebar-overlay" (click)="isMobileSidebarOpen.set(false)"></div>
  }

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <header class="topbar">
      <button class="mobile-menu-btn mobile-only" (click)="isMobileSidebarOpen.set(true)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <div class="search-wrapper">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <input 
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Buscar canales..."
          class="search-input">
        @if (searchTerm()) {
          <button (click)="clearSearch()" class="search-clear">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        }
      </div>

      <div class="topbar-actions">
        <span class="channel-counter">{{ filteredChannels().length }} canales</span>
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Video Player - Theatre Mode -->
      @if (selectedChannel()) {
        <div class="player-section" [class.theatre]="isTheatreMode()">
          <div class="player-wrapper">
            <div class="player-info-bar">
              <div class="player-channel-info">
                @if (selectedChannel()?.logo) {
                  <img [src]="selectedChannel()!.logo" [alt]="selectedChannel()!.name" class="player-channel-logo" onerror="this.style.display='none'">
                }
                <div>
                  <h2 class="player-channel-name">{{ selectedChannel()?.name }}</h2>
                  <span class="player-channel-cat">
                    <span class="live-dot"></span>
                    {{ selectedChannel()?.categoryName || 'En vivo' }}
                  </span>
                </div>
              </div>
              <div class="player-controls-group">
                <button (click)="toggleTheatreMode()" class="player-control-btn" [title]="isTheatreMode() ? 'Modo normal' : 'Modo teatro'">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    @if (isTheatreMode()) {
                      <path d="M8 3v3a2 2 0 01-2 2H3m18 0h-3a2 2 0 01-2-2V3m0 18v-3a2 2 0 012-2h3M3 16h3a2 2 0 012 2v3"/>
                    } @else {
                      <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                    }
                  </svg>
                </button>
                <button (click)="closePlayer()" class="player-control-btn close-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="video-player-area">
              <app-video-player [channel]="selectedChannel()"></app-video-player>
            </div>
          </div>
        </div>
      }

      <!-- Channels Grid -->
      <div class="channels-section" [class.hidden-channels]="isTheatreMode() && selectedChannel()">
        <!-- Section Header -->
        <div class="channels-header">
          <h2 class="channels-title">
            @if (showFavoritesOnly()) {
              Favoritos
            } @else if (selectedCategoryId()) {
              @for (cat of categories(); track cat.id) {
                @if (cat.id === selectedCategoryId()) {
                  {{ cat.name }}
                }
              }
            } @else {
              Todos los canales
            }
          </h2>
        </div>

        <!-- Grid -->
        <div class="channels-grid">
          @for (channel of filteredChannels(); track channel.id) {
            <button
              (click)="selectChannel(channel)"
              [class.playing]="selectedChannel()?.id === channel.id"
              class="channel-card">
              <div class="channel-thumb">
                @if (channel.logo) {
                  <img [src]="channel.logo" [alt]="channel.name" loading="lazy" onerror="this.style.display='none'">
                }
                @if (!channel.logo) {
                  <span class="channel-letter">{{ channel.name.charAt(0) }}</span>
                }
                <!-- Favorite -->
                <button 
                  (click)="$event.stopPropagation(); toggleFavorite(channel.id, $event)"
                  class="fav-btn"
                  [class.is-fav]="isFavorite(channel.id)">
                  <svg viewBox="0 0 24 24" [attr.fill]="isFavorite(channel.id) ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2">
                    <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                  </svg>
                </button>
                <!-- Playing -->
                @if (selectedChannel()?.id === channel.id) {
                  <div class="playing-badge">
                    <span class="eq-bar"></span>
                    <span class="eq-bar"></span>
                    <span class="eq-bar"></span>
                  </div>
                }
              </div>
              <div class="channel-info">
                <span class="channel-name">{{ channel.name }}</span>
                <span class="channel-category">{{ channel.categoryName || 'General' }}</span>
              </div>
            </button>
          }
        </div>

        <!-- Empty State -->
        @if (filteredChannels().length === 0) {
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <h3>No se encontraron canales</h3>
            <p>Prueba con otra categoría o búsqueda</p>
          </div>
        }
      </div>
    </div>
  </main>
</div>
